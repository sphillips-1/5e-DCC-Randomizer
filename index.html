<!DOCTYPE HTML>
<html>

<head>
    <script src="js/jquery-3.4.1.min.js"></script>
    <script src="js/RandomTreasureHoard.js" type="text/javascript"></script>
    <script src="js/GetRomanceNovels.js" type="text/javascript"></script>
    <script src="js/GetSkyrimAdventure.js" type="text/javascript"></script>
    <script src="js/GetRandomPlaybookMove.js" type="text/javascript"></script>
    <script src="js/GetRandomCrawlLoot.js" type="text/javascript"></script>
    <link rel="stylesheet" href="styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        .spell-card {
            border: 1px solid #000;
            border-radius: 10px;
            padding: 10px;
            margin: 10px;
            background-color: #f9f9f9;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .spell-card h2 {
            margin: 0;
            font-size: 1.5em;
        }

        .spell-card p {
            margin: 5px 0;
        }
    </style>
</head>

<body>
    <div class="sidebar">
        <a href="#RandomCrawlLoot" id="tab_RandomCrawlLoot" onclick="cleanUp(); get_RandomCrawlLoot()">Random Crawl Loot</a>
        <a href="#SpellList" id="tab_SpellList" onclick="cleanUp(); get_SpellList()">Spell List</a>
    </div>

    <div class="content">
        <div id="title"></div>
        <div id="main"></div>
        <div id="output"></div>
        <div id="spell-list"></div>
    </div>
</body>

</html>
<script>
    function cleanUp() {
        document.getElementById("title").innerHTML = "";
        document.getElementById("main").innerHTML = "";
        document.getElementById("output").innerHTML = "";
        document.getElementById("spell-list").innerHTML = "";

        document.getElementById("tab_RandomCrawlLoot").className = "inactive";
        document.getElementById("tab_SpellList").className = "inactive";
    }

    function get_RandomCrawlLoot() {
        document.getElementById("tab_RandomCrawlLoot").className = "active";
        document.getElementById("title").innerHTML = "<h1>Random Crawl Loot</h1>";

        var output = "<input type='number' id='character_level' name='character_level' min='1' max='20' placeholder='Enter character level'>" +
            "<input type='button' value='Go!' onclick='generateCrawlLoot()'>";

        document.getElementById("main").innerHTML = output;
        document.getElementById("output").innerHTML = "";
    }

    async function generateCrawlLoot() {
        var characterLevel = document.getElementById("character_level").value;
        var loot = GetCrawlLoot(characterLevel);
        var spellDescription = loot.spell ? await getSpellDescription(loot.spell.spellName) : "None available for this level";
        var output = "<div class='spell-card'>" +
            "<h1>Crawl Item</h1>" +
            "<h2>Name: " + loot.equipment.EquipmentName + " of " + loot.spell.spellName + "</h2>" +
            "<p>This item allows you to cast the spell " + loot.spell.spellName + " once per long rest.</p>" +
            "<p>Your spellcasting stat for this item is your class's primary ability stat. If your class has spell slots, you may use those spell slots to cast these spells additional times as long as the spell slot matches the spell level.</p>" +
            "<p>This is an item specific to the Crawl and requires attunement. Attuning to an item requires a creature to spend a short rest focused on only that item while being in physical contact with it. An item can be attuned to only one creature at a time, and a creature can be attuned to 1 item per item slot.</p>" +
            "<p>Weapon Damage: " + loot.equipment.damage + "</p>" +
            "<p>Notes: " + loot.equipment.notes + "</p>" +
            "<h2>Spell</h2>";
        if (loot.spell) {
            output += "<p>Name: " + loot.spell.spellName + "</p>" +
                "<p>Level: " + (loot.spell.spellLevel === 0 ? "Cantrip" : loot.spell.spellLevel) + "</p>" +
                "<p>Character Level: " + loot.spell.characterLevel + "</p>" +
                "<p>Description: " + spellDescription + "</p>";
        } else {
            output += "<p>None available for this level</p>";
        }
        output += "</div>";
        document.getElementById("output").innerHTML = output;
    }

    async function getSpellDescription(spellName) {
        const response = await fetch(`https://www.dnd5eapi.co/api/spells/${spellName.toLowerCase().replace(/ /g, '-')}`);
        if (!response.ok) {
            return "Description not available.";
        }
        const spellData = await response.json();
        return spellData.desc.join(" ");
    }

    async function getSpellList() {
        const response = await fetch('https://www.dnd5eapi.co/api/spells');
        if (!response.ok) {
            return [];
        }
        const spellList = await response.json();
        return spellList.results;
    }

    async function displaySpellList() {
        const spells = await getSpellList();
        let output = "<ul>";
        for (const spell of spells) {
            const spellDetails = await fetch(`https://www.dnd5eapi.co${spell.url}`);
            const spellData = await spellDetails.json();
            output += `<li>${spell.name} (Level: ${spellData.level})</li>`;
        }
        output += "</ul>";
        document.getElementById("spell-list").innerHTML = output;
    }

    function get_SpellList() {
        document.getElementById("tab_SpellList").className = "active";
        document.getElementById("title").innerHTML = "<h1>Spell List</h1>";
        document.getElementById("main").innerHTML = "";
        document.getElementById("output").innerHTML = "";
        displaySpellList();
    }
</script>